---
/**
 * FeatureHighlight - Alternating image/text feature sections
 *
 * @description
 * Displays features with alternating image and text layout.
 * Great for detailed feature explanations with visual support.
 *
 * @example Basic usage
 * ```astro
 * <FeatureHighlight
 *   features={[
 *     {
 *       title: "Lightning Fast Deploys",
 *       description: "Push to deploy in seconds.",
 *       image: "/images/feature-deploy.png",
 *       highlights: ["Automatic builds", "Zero downtime"],
 *       cta: { label: "Learn more", href: "/features/deploy" }
 *     }
 *   ]}
 * />
 * ```
 */

import { Icon } from 'astro-icon/components';

interface FeatureItem {
  /** Feature title */
  title: string;
  /** Feature description */
  description: string;
  /** Feature image URL */
  image?: string;
  /** Icon name (if no image) */
  icon?: string;
  /** Bullet point highlights */
  highlights?: string[];
  /** Optional badge/label */
  badge?: string;
  /** Call to action - link or add to cart button */
  cta?: {
    label: string;
    href: string;
    addToCart?: boolean;
  };
  /** Product ID for cart (when addToCart is true) */
  productId?: string;
}

interface Props {
  /** Section title */
  title?: string;
  /** Section subtitle */
  subtitle?: string;
  /** Array of features */
  features: FeatureItem[];
  /** Start with image on left or right */
  startImageLeft?: boolean;
  /** Section background style */
  background?: 'default' | 'muted' | 'accent';
  /** Compact heading (smaller size) */
  compact?: boolean;
}

const { title, subtitle, features, startImageLeft = true, background = 'default', compact = false } = Astro.props;

const bgClass = {
  default: 'bg-background',
  muted: 'bg-surface',
  accent: 'bg-primary/5',
}[background];

const hasHeading = title || subtitle;
---

<section class:list={['py-section', bgClass]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {
      hasHeading && (
        <div class:list={['text-center', compact ? 'mb-10' : 'mb-16']}>
          {title && (
            <h2
              class:list={[
                'font-bold text-text',
                compact ? 'text-xl sm:text-2xl' : 'text-3xl sm:text-4xl',
              ]}
            >
              {title}
            </h2>
          )}
          {subtitle && <p class="mt-4 text-lg text-text-muted max-w-2xl mx-auto">{subtitle}</p>}
        </div>
      )
    }

    <div class="space-y-16 lg:space-y-24">
      {
        features.map((feature, index) => {
          const imageOnLeft = startImageLeft ? index % 2 === 0 : index % 2 === 1;

          return (
            <div
              class:list={[
                'flex flex-col gap-8 lg:gap-16 items-center',
                imageOnLeft ? 'lg:flex-row' : 'lg:flex-row-reverse',
              ]}
            >
              {/* Image/Visual Side */}
              <div class="flex-1 w-full">
                {feature.image ? (
                  <div class="relative rounded-2xl overflow-hidden border border-border bg-surface shadow-xl">
                    <img
                      src={feature.image}
                      alt={feature.title}
                      class="w-full h-auto object-contain"
                      loading="lazy"
                    />
                    {/* Gradient overlay - adapts to dark/light */}
                    <div class="absolute inset-0 bg-linear-to-t from-black/10 to-transparent dark:from-black/5 pointer-events-none" />
                  </div>
                ) : (
                  <div class="aspect-video rounded-2xl bg-linear-to-br from-primary/10 to-primary/5 border border-border flex items-center justify-center">
                    {feature.icon ? (
                      <Icon name={feature.icon} class="w-32 h-32 text-primary/40" />
                    ) : (
                      <div class="w-32 h-32 rounded-full bg-primary/20 flex items-center justify-center">
                        <Icon name="lucide:sparkles" class="w-16 h-16 text-primary" />
                      </div>
                    )}
                  </div>
                )}
              </div>

              {/* Content Side */}
              <div class="flex-1 w-full">
                {feature.badge && (
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary mb-4">
                    {feature.badge}
                  </span>
                )}

                <h3 class="text-2xl lg:text-3xl font-bold text-text mb-4">{feature.title}</h3>

                <p class="text-lg text-text-muted leading-relaxed mb-6">{feature.description}</p>

                {feature.highlights && feature.highlights.length > 0 && (
                  <ul class="space-y-3 mb-8">
                    {feature.highlights.map((highlight) => (
                      <li class="flex items-start gap-3">
                        <Icon
                          name="lucide:check-circle"
                          class="w-5 h-5 text-primary mt-0.5 shrink-0"
                        />
                        <span class="text-text">{highlight}</span>
                      </li>
                    ))}
                  </ul>
                )}

                {feature.cta &&
                  (feature.cta.addToCart ? (
                    <button
                      type="button"
                      class="inline-flex items-center gap-2 px-4 py-2.5 rounded-md bg-primary text-primary-foreground font-medium hover:bg-primary-dark transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
                      data-add-to-cart={feature.productId || ''}
                      aria-label={`${feature.cta.label} - ${feature.title}`}
                    >
                      <Icon name="lucide:shopping-cart" class="w-4 h-4" />
                      {feature.cta.label}
                    </button>
                  ) : (
                    <a
                      href={feature.cta.href}
                      class="inline-flex items-center gap-2 text-primary font-medium hover:underline"
                    >
                      {feature.cta.label}
                      <Icon name="lucide:arrow-right" class="w-4 h-4" />
                    </a>
                  ))}
              </div>
            </div>
          );
        })
      }
    </div>
  </div>
</section>
