---
import { getCollection, type CollectionEntry } from 'astro:content';
import MarketingLayout from '../layouts/MarketingLayout.astro';
import Hero from '../components/sections/Hero.astro';
import LogoCloud from '../components/sections/LogoCloud.astro';
import FeaturesSection from '../components/sections/FeaturesSection.astro';
import TestimonialsSection from '../components/sections/TestimonialsSection.astro';
import CTA from '../components/sections/CTA.astro';
import Newsletter from '../components/sections/Newsletter.astro';
import { siteConfig } from '@/config';

type TestimonialEntry = CollectionEntry<'testimonials'>;

const testimonials = await getCollection('testimonials', ({ data }: { data: TestimonialEntry['data'] }) => !data.draft);
const sortedTestimonials = [...testimonials].sort((a: TestimonialEntry, b: TestimonialEntry) => a.data.order - b.data.order);

const features = [
  {
    icon: "lucide:zap",
    title: "Lightning Fast Deploys",
    description: "Push to deploy in seconds, not minutes. Our optimized build pipeline gets your changes live faster than ever."
  },
  {
    icon: "lucide:refresh-cw",
    title: "Automatic Rollbacks",
    description: "Something went wrong? Instantly roll back to any previous deployment with a single click."
  },
  {
    icon: "lucide:globe",
    title: "Global Edge Network",
    description: "Your app runs on 200+ edge locations worldwide, ensuring blazing fast load times for every user."
  },
  {
    icon: "lucide:shield",
    title: "Built-in Security",
    description: "SSL certificates, DDoS protection, and security headers configured automatically for every project."
  },
  {
    icon: "lucide:bar-chart",
    title: "Real-time Analytics",
    description: "Monitor performance, track errors, and understand your users with built-in observability tools."
  },
  {
    icon: "lucide:handshake",
    title: "Team Collaboration",
    description: "Preview deployments for every PR, role-based access control, and seamless Git integration."
  }
];
---

<MarketingLayout 
  title={`${siteConfig.name} - ${siteConfig.description}`}
  description={siteConfig.description}
>
  <Hero
    title="The Deployment Platform Developers Love"
    subtitle="Virex automates your entire workflow from GitHub to Global Edge. Build, preview, and ship applications with a single click. No server management needed."
    primaryCTA={{ label: "Get Started Free", href: "/register" }}
    secondaryCTA={{ label: "View Documentation", href: "/docs" }}
  />

  <LogoCloud
    title="Trusted by innovative teams worldwide"
    logos={[
      { name: "Logo Ipsum 1", src: "/images/logos/logoipsum-1.svg" },
      { name: "Logo Ipsum 2", src: "/images/logos/logoipsum-2.svg" },
      { name: "Logo Ipsum 3", src: "/images/logos/logoipsum-3.svg" },
      { name: "Logo Ipsum 4", src: "/images/logos/logoipsum-4.svg" },
      { name: "Logo Ipsum 5", src: "/images/logos/logoipsum-5.svg" },
      { name: "Logo Ipsum 6", src: "/images/logos/logoipsum-6.svg" }
    ]}
    grayscale={false}
    logoSize='lg'
  />

  <FeaturesSection
    title="Everything you need to ship"
    subtitle="From development to production, Virex provides all the tools your team needs to move fast and stay reliable."
    features={features}
  />

  {siteConfig.features.testimonials && sortedTestimonials.length > 0 && (
    <TestimonialsSection
      title="Loved by developers"
      subtitle="Join thousands of teams who trust Virex to power their deployments."
      testimonials={sortedTestimonials.map((t) => ({
        quote: t.data.quote,
        author: t.data.author,
        role: t.data.role,
        company: t.data.company,
        avatar: t.data.avatar
      }))}
    />
  )}

  <CTA
    title="Ready to ship faster?"
    description="Get started with Virex today. No credit card required for the free tier."
    action={{ label: "Get Started", href: "/register" }}
  />

  <Newsletter />
</MarketingLayout>
